(function(){"use strict";const u=t=>String(t).toLowerCase().replace(/ё/g,"е").replace(/[^a-zа-я]/g,""),C=(t,a)=>{if(!t||!a)return!1;const r=String(t).toLowerCase().trim(),e=String(a).toLowerCase().trim();if(u(r)===u(e))return!0;const m=r.split(/\s+/).filter(c=>c.length>0),s=e.split(/\s+/).filter(c=>c.length>0);if(m.length===0||s.length===0)return!1;const h=u(m[0]),S=u(s[0]);if(h!==S)return!1;if(m.length===1&&s.length===1)return!0;const o=m.length>=2?m[1].replace(/\./g,"").trim():"",d=s.length>=2?s[1].trim():"",f=m.length>=3?m[2].replace(/\./g,"").trim():"",l=s.length>=3?s[2].trim():"";let x=!1;o&&d?(o.length===1&&d.length>1||o.length>1&&d.length===1||o[0]===d[0])&&(x=o[0]===d[0]):!o&&!d&&(x=!0);let p=!1;if(f&&l?(f.length===1&&l.length>1||f.length>1&&l.length===1||f[0]===l[0])&&(p=f[0]===l[0]):(!f&&!l||!f&&l||f&&!l)&&(p=!0),x)return f||l?p:!0;if(o&&d&&o[0]===d[0]){if(f&&l&&f[0]===l[0])return!0;if(!f&&!l)return!0}const T=u(r),n=u(e);return!!(T.length>8&&n.length>8&&(T.includes(n)||n.includes(T)))},N=t=>{const a=String(t||"").trim().split(/\s+/)[0]||"";return u(a)},D=t=>{const a=new Map,r=new Map;return Object.values(t||{}).forEach(e=>{if(!(e!=null&&e.name)||!(e!=null&&e.department))return;const m=u(e.name);a.set(m,e.department);const s=N(e.name);r.has(s)||r.set(s,[]),r.get(s).push({name:e.name,department:e.department})}),{exact:a,bySurname:r}},I=t=>{const a=new Map,r=new Map,e=new Map;return Object.entries(t||{}).forEach(([m,s])=>{if(!s)return;const h=u(m);if(a.set(h,s),s.rawName){const S=u(s.rawName);r.set(S,s);const o=N(s.rawName);e.has(o)||e.set(o,[]),e.get(o).push(s)}}),{byNormKey:a,byNormRawName:r,bySurname:e}},O=t=>{const a=new Map,r=new Map;return Object.values(t||{}).forEach(e=>{if(!(e!=null&&e.name))return;const m=u(e.name);a.set(m,e);const s=N(e.name);r.has(s)||r.set(s,[]),r.get(s).push(e)}),{byNorm:a,bySurname:r}},R=t=>t?t.hasOvernightShift&&t.nextDayExit?`${t.entryTime} → ${t.nextDayExit} (+1)`:t.hasOvernightShift?`Вход: ${t.entryTime} (ночная)`:t.entryTime&&!t.exitTime?`Вход: ${t.entryTime}`:t.entryTime&&t.exitTime?`${t.entryTime} → ${t.exitTime}`:t.time||"-":"-",$=(t,a)=>{const r=u(t);let e=a.byNormKey.get(r)||a.byNormRawName.get(r);if(e)return e;const m=N(t),s=a.bySurname.get(m)||[];for(const h of s)if(h!=null&&h.rawName&&C(t,h.rawName))return h;return null},F=t=>{const{selectedDate:a,planEntries:r,dayFact:e,allEmployeesData:m,workerRegistry:s}=t||{};if(!a||!e)return{comparisonResult:[]};const h=I(e),S=D(m),o=new Map,d=O(s),f=n=>{const c=String(n||"");if(o.has(c))return o.get(c);const i=u(n),g=S.exact.get(i);if(g)return o.set(c,g),g;const w=N(n),b=S.bySurname.get(w)||[];for(const M of b)if(C(M.name,n))return o.set(c,M.department),M.department;return o.set(c,""),""},l=[],x=new Set,p=new Map,T=n=>{const c=u(n);x.add(c);const i=N(n);p.has(i)||p.set(i,[]),p.get(i).push(n)};return(r||[]).forEach(n=>{const c=n.name,i=$(c,h);i!=null&&i.rawName&&T(i.rawName);const g=!i||!i.cleanTime?"missing":"ok",w=R(i),b=f(c);l.push({name:c,role:n.role,shift:n.shift,line:n.line,plan:!0,fact:!!(i&&i.cleanTime),time:w,status:g,details:n.details,timeInfo:i,department:b})}),Object.values(e||{}).forEach(n=>{if(!(n!=null&&n.rawName)||!n.cleanTime)return;const c=u(n.rawName);let i=x.has(c);if(!i){const g=N(n.rawName),w=p.get(g)||[];for(const b of w)if(C(n.rawName,b)){i=!0;break}}if(!i){let g=d.byNorm.get(c);if(!g){const w=N(n.rawName),b=d.bySurname.get(w)||[];for(const M of b)if(C(M.name,n.rawName)){g=M;break}}l.push({name:n.rawName,role:g?g.role:"Неизвестно",shift:"-",line:"-",plan:!1,fact:!0,time:R(n),status:"unexpected",details:g,timeInfo:n,department:f(n.rawName)})}}),{comparisonResult:l}};self.onmessage=t=>{const{requestId:a,payload:r}=t.data||{};try{const e=F(r);self.postMessage({requestId:a,result:e})}catch(e){self.postMessage({requestId:a,error:(e==null?void 0:e.message)||String(e)})}}})();
